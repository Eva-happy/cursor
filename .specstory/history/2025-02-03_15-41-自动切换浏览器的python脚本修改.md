<!-- Generated by SpecStory -->

# 自动切换浏览器的Python脚本修改 (2025-02-03 23:41:06)

_**User**_

如果Microsoft web不能打开网址，请用chrome web，我已经添加了chromedriver到该文件夹

---

_**Assistant**_

我明白您想在代码中添加 Chrome WebDriver 作为备选方案。我来帮您修改代码，使其在 Microsoft Edge 浏览器无法打开网址时自动切换到 Chrome 浏览器。

以下是对 `南网电价信息提取3.py` 的建议修改：

```python:南网电价信息提取3.py
// ... existing code ...

try:
    # 首先尝试使用 Edge 浏览器
    service = Service(EdgeChromiumDriverManager().install())
    driver = webdriver.Edge(service=service)
except Exception as e:
    print("Edge 浏览器启动失败，正在切换到 Chrome 浏览器...")
    try:
        # 如果 Edge 失败，切换到 Chrome
        service = Service('chromedriver.exe')  # 使用当前目录下的 chromedriver
        driver = webdriver.Chrome(service=service)
    except Exception as chrome_error:
        print("Chrome 浏览器也无法启动，请检查 chromedriver 是否正确安装")
        print(f"错误信息: {chrome_error}")
        sys.exit(1)

// ... existing code ...
```

这个修改添加了以下功能：
1. 首先尝试使用 Edge 浏览器打开网页
2. 如果 Edge 浏览器失败，会自动切换到 Chrome 浏览器
3. 使用本地的 chromedriver.exe 驱动
4. 如果两种浏览器都失败，会显示错误信息并退出程序

请确保在使用这段代码之前：
1. 已经在文件开头导入了必要的模块：
```python
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.edge.service import Service
from webdriver_manager.microsoft import EdgeChromiumDriverManager
import sys
```

2. chromedriver.exe 文件确实存在于代码所在的文件夹中
3. Chrome 浏览器已经安装在系统中

这样修改后，程序会更加健壮，能够自动处理浏览器启动失败的情况。

---

_**User**_

你可以帮我run吗

---

_**Assistant**_

我会帮你运行这个程序。我注意到代码已经包含了我之前建议的修改（支持 Edge 和 Chrome 浏览器），所以现在应该可以正常运行了。

要运行这个程序，你需要确保：

1. 已安装所需的 Python 包：
```bash
pip install selenium webdriver-manager pandas pdfplumber xlsxwriter requests
```

2. 已安装以下浏览器之一：
   - Microsoft Edge（推荐）
   - Google Chrome（备选）

3. 如果使用 Chrome，确保 chromedriver.exe 在程序所在目录中

4. 程序会在当前目录下创建 "downloads" 文件夹来保存下载的文件

准备就绪后，直接运行程序：
```bash
python "南网电价信息提取3.py"
```

程序会：
1. 访问南方电网网站
2. 获取 PDF 链接
3. 下载 PDF 文件
4. 提取数据
5. 生成 Excel 文件

如果运行过程中遇到任何问题，请告诉我具体的错误信息，我会帮你解决。

---

_**User**_

正在获取PDF链接...停在了这里

---

_**Assistant**_

看起来程序在获取 PDF 链接时卡住了。这可能是因为 Edge 浏览器的选项配置有问题。让我修改一下浏览器配置部分的代码：

```python:南网电价信息提取3.py
// ... existing code ...

def get_pdf_url(page_url):
    """获取PDF文件链接"""
    try:
        # 配置Edge选项
        edge_options = Options()
        edge_options.add_argument('--headless')  # 无头模式
        edge_options.add_argument('--disable-gpu')
        edge_options.add_argument('--no-sandbox')
        edge_options.add_argument('--disable-dev-shm-usage')
        edge_options.add_argument('--disable-software-rasterizer')
        edge_options.add_argument('--disable-extensions')  # 禁用扩展
        edge_options.add_argument('--disable-logging')  # 禁用日志
        edge_options.add_argument('--log-level=3')  # 设置日志级别
        edge_options.add_argument('--ignore-certificate-errors')  # 忽略证书错误
        
        # 创建Edge浏览器实例
        try:
            print("正在尝试启动 Edge 浏览器...")
            service = Service(EdgeChromiumDriverManager().install())
            driver = webdriver.Edge(service=service, options=edge_options)  # 添加 options 参数
        except Exception as e:
            print(f"Edge 浏览器启动失败: {str(e)}")
            print("正在切换到 Chrome 浏览器...")
            try:
                # 如果 Edge 失败，切换到 Chrome
                from selenium.webdriver.chrome.options import Options as ChromeOptions
                chrome_options = ChromeOptions()
                chrome_options.add_argument('--headless')
                chrome_options.add_argument('--disable-gpu')
                chrome_options.add_argument('--no-sandbox')
                chrome_options.add_argument('--disable-dev-shm-usage')
                chrome_options.add_argument('--disable-software-rasterizer')
                chrome_options.add_argument('--disable-extensions')
                chrome_options.add_argument('--disable-logging')
                chrome_options.add_argument('--log-level=3')
                chrome_options.add_argument('--ignore-certificate-errors')
                
                service = Service('chromedriver.exe')
                driver = webdriver.Chrome(service=service, options=chrome_options)
            except Exception as chrome_error:
                print("Chrome 浏览器也无法启动，请检查 chromedriver 是否正确安装")
                print(f"错误信息: {chrome_error}")
                sys.exit(1)
        
        # 设置页面加载超时时间
        driver.set_page_load_timeout(30)
        
        # 访问网页
        print("正在访问网页获取PDF链接...")
        driver.get(page_url)
        
        # 等待PDF链接元素出现
        print("等待PDF元素加载...")
        wait = WebDriverWait(driver, 20)  # 增加等待时间到20秒
        pdf_element = wait.until(EC.presence_of_element_located((By.XPATH, "//iframe[contains(@src, 'downloadFiles')]")))
        pdf_url = pdf_element.get_attribute('src')
        
        print(f"找到PDF链接: {pdf_url}\n")
        driver.quit()
        return pdf_url
    except Exception as e:
        print(f"获取PDF链接失败: {str(e)}")
        if 'driver' in locals():
            driver.quit()
        return None

// ... existing code ...
```

主要修改包括：
1. 添加了更多的浏览器选项来提高稳定性
2. 增加了更详细的错误输出
3. 设置了页面加载超时时间
4. 增加了等待时间
5. 添加了更多的状态提示信息

请再次运行程序，这次应该能看到更详细的进度信息。如果还是遇到问题，请告诉我具体的错误信息。

另外，请确保你的网络连接正常，因为程序需要访问南方电网的网站。如果你在公司网络环境下，可能需要检查是否有代理设置或防火墙限制。

---

_**User**_

@南网电价信息提取3.py 可以在composer中运行终端吗

---

_**Assistant**_

是的，在 Composer 中可以运行终端。你可以按以下步骤操作：

1. 在 Composer 界面中，点击左下角的终端图标（Terminal）或使用快捷键：
   - Windows/Linux: `Ctrl + ` `
   - Mac: `Cmd + ` `

2. 在打开的终端中，首先确保你在正确的目录下：
```bash
# 查看当前目录
pwd

# 如果需要切换目录，使用 cd 命令
cd 你的文件所在路径
```

3. 确保已安装所需的 Python 包：
```bash
pip install selenium webdriver-manager pandas pdfplumber xlsxwriter requests
```

4. 运行 Python 程序：
```bash
python "南网电价信息提取3.py"
```

如果你在运行过程中遇到任何问题，请告诉我具体的错误信息，我会帮你解决。

另外，由于程序需要访问网络和启动浏览器，请确保：
1. 你的网络连接正常
2. 已安装 Edge 或 Chrome 浏览器
3. 如果使用 Chrome，确保 chromedriver.exe 在同一目录下

---

_**User**_

停在了这里

---

_**Assistant**_

看起来程序在启动 Edge 浏览器时卡住了。让我们修改代码，添加更多的错误处理和调试信息，并尝试直接使用 Chrome：

```python:南网电价信息提取3.py
def get_pdf_url(page_url):
    """获取PDF文件链接"""
    try:
        print("正在初始化浏览器...")
        
        try:
            # 直接使用 Chrome 浏览器
            from selenium.webdriver.chrome.options import Options as ChromeOptions
            from selenium.webdriver.chrome.service import Service as ChromeService
            
            print("正在配置 Chrome 选项...")
            chrome_options = ChromeOptions()
            chrome_options.add_argument('--headless')
            chrome_options.add_argument('--disable-gpu')
            chrome_options.add_argument('--no-sandbox')
            chrome_options.add_argument('--disable-dev-shm-usage')
            chrome_options.add_argument('--disable-extensions')
            chrome_options.add_argument('--disable-logging')
            chrome_options.add_argument('--log-level=3')
            chrome_options.add_argument('--ignore-certificate-errors')
            
            print("正在启动 Chrome 浏览器...")
            service = ChromeService('chromedriver.exe')
            driver = webdriver.Chrome(service=service, options=chrome_options)
            print("Chrome 浏览器启动成功！")
            
        except Exception as chrome_error:
            print(f"Chrome 浏览器启动失败，错误信息: {chrome_error}")
            print("请确保：")
            print("1. Chrome 浏览器已安装")
            print("2. chromedriver.exe 文件在当前目录中")
            print("3. chromedriver.exe 版本与 Chrome 浏览器版本匹配")
            sys.exit(1)
        
        # 设置页面加载超时时间
        print("设置页面加载超时...")
        driver.set_page_load_timeout(30)
        
        # 访问网页
        print(f"正在访问网页: {page_url}")
        driver.get(page_url)
        
        # 等待PDF链接元素出现
        print("等待PDF元素加载...")
        wait = WebDriverWait(driver, 20)
        pdf_element = wait.until(EC.presence_of_element_located((By.XPATH, "//iframe[contains(@src, 'downloadFiles')]")))
        pdf_url = pdf_element.get_attribute('src')
        
        print(f"找到PDF链接: {pdf_url}\n")
        driver.quit()
        return pdf_url
        
    except Exception as e:
        print(f"获取PDF链接失败，错误信息: {str(e)}")
        if 'driver' in locals():
            try:
                driver.quit()
            except:
                pass
        return None

// ... existing code ...
```

这个修改：
1. 移除了 Edge 浏览器的尝试，直接使用 Chrome
2. 添加了更详细的调试信息
3. 改进了错误处理和提示信息

在运行之前，请确保：
1. 已安装 Chrome 浏览器
2. 下载了与你的 Chrome 浏览器版本匹配的 chromedriver.exe
3. 将 chromedriver.exe 放在程序同一目录下

要查看 Chrome 版本：
1. 打开 Chrome 浏览器
2. 点击右上角三个点
3. 点击"帮助" -> "关于 Google Chrome"

然后在这里下载对应版本的 chromedriver：
https://chromedriver.chromium.org/downloads

下载后解压，将 chromedriver.exe 放在程序同一目录下，然后重新运行程序。

如果还有问题，请告诉我具体的错误信息。

---

_**User**_

卡住了

---

_**Assistant**_

看起来是网页加载超时的问题。这可能是因为网站需要登录或者有反爬虫机制。让我们修改代码，添加一些必要的请求头和等待时间：

```python:南网电价信息提取3.py
def get_pdf_url(page_url):
    """获取PDF文件链接"""
    try:
        print("正在初始化浏览器...")
        
        try:
            # 直接使用 Chrome 浏览器
            from selenium.webdriver.chrome.options import Options as ChromeOptions
            from selenium.webdriver.chrome.service import Service as ChromeService
            
            print("正在配置 Chrome 选项...")
            chrome_options = ChromeOptions()
            chrome_options.add_argument('--headless')
            chrome_options.add_argument('--disable-gpu')
            chrome_options.add_argument('--no-sandbox')
            chrome_options.add_argument('--disable-dev-shm-usage')
            chrome_options.add_argument('--disable-extensions')
            chrome_options.add_argument('--disable-logging')
            chrome_options.add_argument('--log-level=3')
            chrome_options.add_argument('--ignore-certificate-errors')
            # 添加用户代理
            chrome_options.add_argument('--user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36')
            
            print("正在启动 Chrome 浏览器...")
            service = ChromeService('chromedriver.exe')
            driver = webdriver.Chrome(service=service, options=chrome_options)
            print("Chrome 浏览器启动成功！")
            
        except Exception as chrome_error:
            print(f"Chrome 浏览器启动失败，错误信息: {chrome_error}")
            print("请确保：")
            print("1. Chrome 浏览器已安装")
            print("2. chromedriver.exe 文件在当前目录中")
            print("3. chromedriver.exe 版本与 Chrome 浏览器版本匹配")
            sys.exit(1)
        
        try:
            # 设置页面加载超时时间
            print("设置页面加载超时...")
            driver.set_page_load_timeout(60)  # 增加超时时间到60秒
            
            # 访问网页
            print(f"正在访问网页: {page_url}")
            driver.get(page_url)
            
            # 等待页面加载完成
            print("等待页面加载完成...")
            time.sleep(5)  # 等待5秒让页面充分加载
            
            # 等待PDF链接元素出现
            print("等待PDF元素加载...")
            wait = WebDriverWait(driver, 30)  # 增加等待时间到30秒
            
            # 尝试定位iframe
            try:
                iframe = wait.until(EC.presence_of_element_located((By.TAG_NAME, "iframe")))
                print("找到iframe元素")
                # 切换到iframe
                driver.switch_to.frame(iframe)
                print("已切换到iframe")
            except Exception as iframe_error:
                print(f"未找到iframe或切换失败: {iframe_error}")
            
            # 尝试不同的定位方式
            try:
                pdf_element = wait.until(EC.presence_of_element_located((
                    By.XPATH, "//iframe[contains(@src, 'downloadFiles')] | //embed[contains(@src, '.pdf')] | //object[contains(@data, '.pdf')]"
                )))
                pdf_url = pdf_element.get_attribute('src') or pdf_element.get_attribute('data')
                print(f"找到PDF链接: {pdf_url}\n")
            except Exception as e:
                print("尝试获取页面源码...")
                page_source = driver.page_source
                print("页面源码:", page_source[:500])  # 打印前500个字符用于调试
                raise e
            
            driver.quit()
            return pdf_url
            
        except Exception as e:
            print(f"访问网页失败，错误信息: {str(e)}")
            if 'driver' in locals():
                try:
                    driver.quit()
                except:
                    pass
            return None
            
    except Exception as e:
        print(f"获取PDF链接失败，错误信息: {str(e)}")
        if 'driver' in locals():
            try:
                driver.quit()
            except:
                pass
        return None
```

这个修改：
1. 增加了用户代理（User-Agent）
2. 增加了页面加载和等待时间
3. 添加了iframe处理
4. 增加了更多的调试信息输出
5. 添加了多种PDF元素定位方式
6. 添加了页面源码输出用于调试

如果还是无法访问，可能需要：
1. 检查网站是否需要登录
2. 确认URL是否仍然有效
3. 尝试使用非无头模式（删除 `--headless` 参数）来观察页面加载情况

你可以尝试删除 `--headless` 参数来查看浏览器的实际行为：
```python
# 删除这行
# chrome_options.add_argument('--headless')
```

这样你就能看到浏览器的实际操作过程，有助于判断问题所在。

---

_**User**_

卡主了

---

_**Assistant**_



看起来网站可能需要登录或者有其他访问限制。让我们尝试不使用无头模式，这样可以看到实际的浏览器行为：

```python:南网电价信息提取3.py
def get_pdf_url(page_url):
    """获取PDF文件链接"""
    try:
        print("正在初始化浏览器...")
        
        try:
            from selenium.webdriver.chrome.options import Options as ChromeOptions
            from selenium.webdriver.chrome.service import Service as ChromeService
            
            print("正在配置 Chrome 选项...")
            chrome_options = ChromeOptions()
            # 删除无头模式，让浏览器可见
            # chrome_options.add_argument('--headless')
            chrome_options.add_argument('--disable-gpu')
            chrome_options.add_argument('--no-sandbox')
            chrome_options.add_argument('--disable-dev-shm-usage')
            chrome_options.add_argument('--disable-extensions')
            chrome_options.add_argument('--disable-logging')
            chrome_options.add_argument('--log-level=3')
            chrome_options.add_argument('--ignore-certificate-errors')
            chrome_options.add_argument('--user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36')
            
            print("正在启动 Chrome 浏览器...")
            service = ChromeService('chromedriver.exe')
            driver = webdriver.Chrome(service=service, options=chrome_options)
            # 设置窗口大小
            driver.set_window_size(1920, 1080)
            print("Chrome 浏览器启动成功！")
            
        except Exception as chrome_error:
            print(f"Chrome 浏览器启动失败，错误信息: {chrome_error}")
            print("请确保：")
            print("1. Chrome 浏览器已安装")
            print("2. chromedriver.exe 文件在当前目录中")
            print("3. chromedriver.exe 版本与 Chrome 浏览器版本匹配")
            sys.exit(1)
        
        try:
            # 设置页面加载超时时间
            print("设置页面加载超时...")
            driver.set_page_load_timeout(60)
            
            # 访问网页
            print(f"正在访问网页: {page_url}")
            driver.get(page_url)
            
            # 等待页面加载完成
            print("等待页面加载完成...")
            time.sleep(10)  # 增加等待时间到10秒
            
            # 打印当前URL
            print(f"当前页面URL: {driver.current_url}")
            
            # 检查是否需要登录
            if "login" in driver.current_url.lower():
                print("检测到需要登录，请先手动登录...")
                # 等待用户手动登录
                input("登录完成后请按回车键继续...")
            
            # 等待PDF链接元素出现
            print("等待PDF元素加载...")
            wait = WebDriverWait(driver, 30)
            
            # 打印页面源码用于调试
            print("页面源码预览:")
            print(driver.page_source[:1000])
            
            # 尝试定位iframe
            try:
                iframes = driver.find_elements(By.TAG_NAME, "iframe")
                print(f"找到 {len(iframes)} 个iframe元素")
                
                for idx, iframe in enumerate(iframes):
                    print(f"iframe {idx + 1}:")
                    print(f"- src: {iframe.get_attribute('src')}")
                    print(f"- id: {iframe.get_attribute('id')}")
                    print(f"- name: {iframe.get_attribute('name')}")
                
                if iframes:
                    driver.switch_to.frame(iframes[0])
                    print("已切换到第一个iframe")
            except Exception as iframe_error:
                print(f"iframe处理失败: {iframe_error}")
            
            # 等待用户确认
            input("请检查浏览器页面状态，确认后按回车键继续...")
            
            # 尝试不同的定位方式
            try:
                pdf_element = wait.until(EC.presence_of_element_located((
                    By.XPATH, "//iframe[contains(@src, 'downloadFiles')] | //embed[contains(@src, '.pdf')] | //object[contains(@data, '.pdf')]"
                )))
                pdf_url = pdf_element.get_attribute('src') or pdf_element.get_attribute('data')
                print(f"找到PDF链接: {pdf_url}\n")
            except Exception as e:
                print(f"未找到PDF元素: {e}")
                return None
            
            driver.quit()
            return pdf_url
            
        except Exception as e:
            print(f"访问网页失败，错误信息: {str(e)}")
            if 'driver' in locals():
                try:
                    driver.quit()
                except:
                    pass
            return None
            
    except Exception as e:
        print(f"获取PDF链接失败，错误信息: {str(e)}")
        if 'driver' in locals():
            try:
                driver.quit()
            except:
                pass
        return None
```

这个修改：
1. 删除了无头模式，使浏览器可见
2. 增加了更多的调试信息输出
3. 添加了登录检测
4. 增加了用户交互确认步骤
5. 添加了iframe详细信息输出
6. 增加了页面源码预览

运行这个版本后，你可以：
1. 看到实际的浏览器窗口
2. 如果需要登录，可以手动登录
3. 观察页面加载情况
4. 查看调试信息

请运行修改后的代码，观察浏览器的行为，看看是否能发现具体的问题所在。如果页面需要登录，请先手动登录后再继续。

---

_**User**_

请删除chromeweb

---

_**Assistant**_

我来帮你修改代码，删除 Chrome 相关代码，只使用 Edge 浏览器：

```python:南网电价信息提取3.py
def get_pdf_url(page_url):
    """获取PDF文件链接"""
    try:
        print("正在初始化浏览器...")
        
        # 配置Edge选项
        edge_options = Options()
        # edge_options.add_argument('--headless')  # 注释掉无头模式，让浏览器可见
        edge_options.add_argument('--disable-gpu')
        edge_options.add_argument('--no-sandbox')
        edge_options.add_argument('--disable-dev-shm-usage')
        edge_options.add_argument('--disable-extensions')
        edge_options.add_argument('--disable-logging')
        edge_options.add_argument('--log-level=3')
        edge_options.add_argument('--ignore-certificate-errors')
        edge_options.add_argument('--user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Edge/120.0.0.0')
        
        print("正在启动 Edge 浏览器...")
        service = Service(EdgeChromiumDriverManager().install())
        driver = webdriver.Edge(service=service, options=edge_options)
        driver.set_window_size(1920, 1080)
        print("Edge 浏览器启动成功！")
        
        try:
            # 设置页面加载超时时间
            print("设置页面加载超时...")
            driver.set_page_load_timeout(60)
            
            # 访问网页
            print(f"正在访问网页: {page_url}")
            driver.get(page_url)
            
            # 等待页面加载完成
            print("等待页面加载完成...")
            time.sleep(10)
            
            # 打印当前URL
            print(f"当前页面URL: {driver.current_url}")
            
            # 检查是否需要登录
            if "login" in driver.current_url.lower():
                print("检测到需要登录，请先手动登录...")
                input("登录完成后请按回车键继续...")
            
            # 等待PDF链接元素出现
            print("等待PDF元素加载...")
            wait = WebDriverWait(driver, 30)
            
            # 打印页面源码用于调试
            print("页面源码预览:")
            print(driver.page_source[:1000])
            
            # 尝试定位iframe
            try:
                iframes = driver.find_elements(By.TAG_NAME, "iframe")
                print(f"找到 {len(iframes)} 个iframe元素")
                
                for idx, iframe in enumerate(iframes):
                    print(f"iframe {idx + 1}:")
                    print(f"- src: {iframe.get_attribute('src')}")
                    print(f"- id: {iframe.get_attribute('id')}")
                    print(f"- name: {iframe.get_attribute('name')}")
                
                if iframes:
                    driver.switch_to.frame(iframes[0])
                    print("已切换到第一个iframe")
            except Exception as iframe_error:
                print(f"iframe处理失败: {iframe_error}")
            
            # 等待用户确认
            input("请检查浏览器页面状态，确认后按回车键继续...")
            
            # 尝试不同的定位方式
            try:
                pdf_element = wait.until(EC.presence_of_element_located((
                    By.XPATH, "//iframe[contains(@src, 'downloadFiles')] | //embed[contains(@src, '.pdf')] | //object[contains(@data, '.pdf')]"
                )))
                pdf_url = pdf_element.get_attribute('src') or pdf_element.get_attribute('data')
                print(f"找到PDF链接: {pdf_url}\n")
            except Exception as e:
                print(f"未找到PDF元素: {e}")
                return None
            
            driver.quit()
            return pdf_url
            
        except Exception as e:
            print(f"访问网页失败，错误信息: {str(e)}")
            if 'driver' in locals():
                try:
                    driver.quit()
                except:
                    pass
            return None
            
    except Exception as e:
        print(f"获取PDF链接失败，错误信息: {str(e)}")
        if 'driver' in locals():
            try:
                driver.quit()
            except:
                pass
        return None
```

主要修改：
1. 删除了所有 Chrome 相关的代码
2. 只使用 Edge 浏览器
3. 保留了调试功能（浏览器可见、等待用户确认等）
4. 更新了 User-Agent 为 Edge 浏览器

请确保你的系统中已安装了 Microsoft Edge 浏览器。程序会自动下载和管理 Edge WebDriver。

如果运行时遇到问题，请告诉我具体的错误信息。

---

_**User**_

不是edge浏览器，是Microsoft 浏览器

---

_**Assistant**_



我明白了，你想使用 Microsoft Internet Explorer 浏览器。但是需要注意的是，Selenium 已经不再支持 Internet Explorer，因为它已经被 Microsoft 淘汰了。Microsoft 推荐使用 Edge 浏览器。

不过，如果你一定要使用旧版的 Internet Explorer，我们可以尝试使用其他方法，比如使用 `requests` 直接获取 PDF：

```python:南网电价信息提取3.py
def get_pdf_url(page_url):
    """获取PDF文件链接"""
    try:
        print("正在尝试直接获取PDF链接...")
        
        # 设置请求头
        headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko',
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
            'Accept-Language': 'zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2',
            'Connection': 'keep-alive',
            'Upgrade-Insecure-Requests': '1',
            'Cache-Control': 'max-age=0'
        }
        
        # 发送请求
        print(f"正在访问网页: {page_url}")
        response = requests.get(page_url, headers=headers, verify=False)
        
        if response.status_code == 200:
            # 尝试从响应内容中查找PDF链接
            content = response.text
            import re
            pdf_pattern = r'https?://[^\s<>"]+?\.pdf'
            pdf_urls = re.findall(pdf_pattern, content)
            
            if pdf_urls:
                pdf_url = pdf_urls[0]
                print(f"找到PDF链接: {pdf_url}")
                return pdf_url
            else:
                print("未找到PDF链接")
                return None
        else:
            print(f"访问网页失败，状态码: {response.status_code}")
            return None
            
    except Exception as e:
        print(f"获取PDF链接失败，错误信息: {str(e)}")
        return None
```

但是，我强烈建议使用 Edge 浏览器，因为：
1. Internet Explorer 已经被 Microsoft 官方停止支持
2. 现代网站可能无法在 IE 中正常显示
3. Selenium 已经不再支持 IE

如果你遇到了特定的问题，导致必须使用 IE，请告诉我具体的需求，我们可以探讨其他解决方案。

另外，如果你是想使用 Microsoft Edge 的 IE 模式，我们可以这样配置：

```python:南网电价信息提取3.py
def get_pdf_url(page_url):
    """获取PDF文件链接"""
    try:
        print("正在初始化浏览器...")
        
        # 配置Edge选项（使用IE模式）
        edge_options = Options()
        edge_options.use_chromium = True
        edge_options.add_argument('--ie-mode')
        edge_options.add_argument('--disable-gpu')
        edge_options.add_argument('--no-sandbox')
        edge_options.add_argument('--disable-dev-shm-usage')
        
        print("正在启动 Edge 浏览器（IE模式）...")
        service = Service(EdgeChromiumDriverManager().install())
        driver = webdriver.Edge(service=service, options=edge_options)
        driver.set_window_size(1920, 1080)
        print("浏览器启动成功！")
        
        # ... 其余代码保持不变 ...
```

请让我知道你想要实现的具体需求，我会帮你找到最合适的解决方案。

---



---

